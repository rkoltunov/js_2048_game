var t={};class e{static Status={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.state=[...t],this.status=e.Status.idle,this.score=0,this.initialState=t}getScore(){return this.score}getState(){return this.state}getStatus(){return this.updateStatus(),this.status}start(){this.status=e.Status.playing,this.state=this.initialState.concat(),this.createRandomTile(),this.createRandomTile(),this.printTiles()}restart(){this.clearTheBoard(),this.printTiles(),this.status=e.Status.idle,this.score=0}moveLeft(){if(this.status!==e.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let a=1;a<4;a++)if(this.state[e][a]>0){let i=0,r=!1;for(;0===this.state[e][a-i-1];)i++;if(s||this.state[e][a-i-1]!==this.state[e][a]||(i++,r=!0),i>0){if(!s&&r){s=!0;let t=2*this.state[e][a-i];this.state[e][a-i]=t,this.score+=t}else s=!1,this.state[e][a-i]=this.state[e][a];this.state[e][a]=0,t=!0}}}return t&&this.createRandomTile(),t}moveRight(){if(this.status!==e.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let a=2;a>=0;a--)if(this.state[e][a]>0){let i=0,r=!1;for(;0===this.state[e][a+i+1];)i++;if(s||this.state[e][a+i+1]!==this.state[e][a]||(i++,r=!0),i>0){if(!s&&r){s=!0;let t=2*this.state[e][a+i];this.state[e][a+i]=t,this.score+=t}else s=!1,this.state[e][a+i]=this.state[e][a];this.state[e][a]=0,t=!0}}}return t&&this.createRandomTile(),t}moveUp(){if(this.status!==e.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let a=1;a<4;a++)if(this.state[a][e]>0){let i=0,r=!1;for(;a-i-1>=0&&0===this.state[a-i-1][e];)i++;if(!s&&a-i-1>=0&&this.state[a-i-1][e]===this.state[a][e]&&(i++,r=!0),i>0){if(!s&&r){s=!0;let t=2*this.state[a-i][e];this.state[a-i][e]=t,this.score+=t}else s=!1,this.state[a-i][e]=this.state[a][e];this.state[a][e]=0,t=!0}}}return t&&this.createRandomTile(),t}moveDown(){if(this.status!==e.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let a=2;a>=0;a--)if(this.state[a][e]>0){let i=0,r=!1;for(;a+i+1<this.state.length&&0===this.state[a+i+1][e];)i++;if(!s&&a+i+1<this.state.length&&this.state[a+i+1][e]===this.state[a][e]&&(i++,r=!0),i>0){if(!s&&r){s=!0;let t=2*this.state[a+i][e];this.state[a+i][e]=t,this.score+=t}else s=!1,this.state[a+i][e]=this.state[a][e];this.state[a][e]=0,t=!0}}}return t&&this.createRandomTile(),t}saveState(){return this.state.map(t=>t.slice())}createRandomTile(){let t=this.randomNumber(3);for(;!this.state[t].includes(0);)t=this.randomNumber(3);let e=this.randomNumber(3);for(;0!==this.state[t][e];)e=this.randomNumber(3);let s=this.state.map(t=>t.slice());s[t][e]=this.generateCellValue(),this.state=s,this.printTiles()}randomNumber(t){return Math.round(Math.random()*t)}generateCellValue(){return Math.random()>.9?4:2}updateStatus(){this.didPlayerWin()?this.status=e.Status.win:this.didPlayerLose()&&(this.status=e.Status.lose)}didPlayerWin(){for(let t of this.state.flat())if(2048===t)return!0;return!1}didPlayerLose(){for(let t of this.state.flat())if(0===t)return!1;for(let t=0;t<=3;t++)for(let e=0;e<=2;e++)if(this.state[t][e]===this.state[t][e+1])return!1;for(let t=0;t<=3;t++)for(let e=0;e<=2;e++)if(this.state[e][t]===this.state[e+1][t])return!1;return!0}printTiles(){let t=document.getElementsByClassName("field-cell"),e=this.state.flat();for(let s=0;s<e.length;s++){let a=t[s],i=e[s];i>0?void 0!==a&&(a.textContent=i,a.className=`field-cell field-cell--${i}`):void 0!==a&&(a.textContent="",a.className="field-cell")}}clearTheBoard(){this.state=this.initialState.concat()}}const s=new(t=e),a=document.querySelector(".start"),i=document.querySelector(".message-start"),r=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),n=document.querySelector(".game-score");let h=0,o=0;function u(e){if(e){var a;a=s.getScore(),n.textContent=a;let e=s.getStatus();e===t.Status.win?r.classList.remove("hidden"):e===t.Status.lose&&l.classList.remove("hidden")}}a.addEventListener("click",function(){a.classList.contains("start")?(a.className="button restart",a.textContent="Restart",i.classList.add("hidden"),s.start()):(a.className="button start",a.textContent="Start",i.classList.remove("hidden"),r.classList.add("hidden"),l.classList.add("hidden"),n.textContent="0",s.restart())}),document.addEventListener("keydown",function(t){t.preventDefault();let e=!1;switch(t.key){case"ArrowUp":e=s.moveUp();break;case"ArrowDown":e=s.moveDown();break;case"ArrowRight":e=s.moveRight();break;case"ArrowLeft":e=s.moveLeft()}u(e)}),document.addEventListener("touchstart",function(t){h=t.touches[0].clientX,o=t.touches[0].clientY}),document.addEventListener("touchend",function(t){let e=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY,i=e-h,r=a-o;(Math.abs(i)>10||Math.abs(r)>10)&&(Math.abs(i)>Math.abs(r)?i>0?s.moveRight():s.moveLeft():r>0?s.moveDown():s.moveUp(),u(!0))});
//# sourceMappingURL=index.73f2749c.js.map
